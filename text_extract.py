import re

def clean_text(text):
    """
    清洗文本：替换换行符、逗号、中文括号，但保留空格
    """
    if text is None:
        return ''
    text = text.replace('\n', '').replace(',', '').replace('（', '(').replace('）', ')')
    return text.strip()

def extract_and_classify_patent_info(text):
    """
    从文本中提取并分类专利信息
    """
    cleaned_text = clean_text(text)

    # 定义正则表达式模式
    patterns = [
        # 发明专利
        (r'新递交发明专利申请\s*(\d+)件', '本年新增申请数', '发明专利'),
        (r'获得发明专利授权\s*(\d+)件', '本年新增获得数', '发明专利'),
        (r'发明专利\s*(\d+)件', '累计数量获得数', '发明专利'),
        (r'累计申请中发明专利\s*(\d+)件', '累计数量申请数', '发明专利'),

        # 实用新型专利
        (r'实用新型专利申请\s*(\d+)件', '本年新增申请数', '实用新型专利'),
        (r'实用新型专利授权\s*(\d+)件', '本年新增获得数', '实用新型专利'),
        (r'实用新型专利\s*(\d+)件', '累计数量获得数', '实用新型专利'),
        (r'累计申请中实用新型专利\s*(\d+)件', '累计数量申请数', '实用新型专利'),

        # 外观设计专利
        (r'外观设计专利申请\s*(\d+)项', '本年新增申请数', '外观设计专利'),
        (r'外观设计专利授权\s*(\d+)项', '本年新增获得数', '外观设计专利'),
        (r'外观设计专利\s*(\d+)项', '累计数量获得数', '外观设计专利'),
        (r'累计申请中外观设计专利\s*(\d+)项', '累计数量申请数', '外观设计专利'),

        # 软件著作权
        (r'软件著作权申请\s*(\d+)项', '本年新增申请数', '软件著作权'),
        (r'软件著作权登记\s*(\d+)项', '本年新增获得数', '软件著作权'),
        (r'计算机软件著作权\s*(\d+)项', '累计数量获得数', '软件著作权'),
        (r'累计申请中软件著作权\s*(\d+)项', '累计数量申请数', '软件著作权'),

        # 其他
        (r'其他知识产权申请\s*(\d+)项', '本年新增申请数', '其他'),
        (r'其他知识产权获得\s*(\d+)项', '本年新增获得数', '其他'),
        (r'其他\s*(\d+)项', '累计数量获得数', '其他'),
        (r'累计申请中其他知识产权\s*(\d+)项', '累计数量申请数', '其他'),

        # 合计
        (r'总计申请\s*(\d+)件', '本年新增申请数', '合计'),
        (r'总计获得\s*(\d+)件', '本年新增获得数', '合计'),
        (r'累计申请总数\s*(\d+)件', '累计数量申请数', '合计'),
        (r'累计获得总数\s*(\d+)件', '累计数量获得数', '合计'),
        (r'公司累计获得授权专利\s*(\d+)\s*件', '累计数量获得数', '合计'),
        (r'目前正在申请的专利为\s*(\d+)\s*件', '累计数量申请数', '合计'),
    ]

    # 初始化数据结构
    patent_data = {
        '发明专利': {'专利类型': '发明专利', '本年新增申请数': '', '本年新增获得数': '', '累计数量申请数': '', '累计数量获得数': ''},
        '实用新型专利': {'专利类型': '实用新型专利', '本年新增申请数': '', '本年新增获得数': '', '累计数量申请数': '', '累计数量获得数': ''},
        '外观设计专利': {'专利类型': '外观设计专利', '本年新增申请数': '', '本年新增获得数': '', '累计数量申请数': '', '累计数量获得数': ''},
        '软件著作权': {'专利类型': '软件著作权', '本年新增申请数': '', '本年新增获得数': '', '累计数量申请数': '', '累计数量获得数': ''},
        '其他': {'专利类型': '其他', '本年新增申请数': '', '本年新增获得数': '', '累计数量申请数': '', '累计数量获得数': ''},
        '合计': {'专利类型': '合计', '本年新增申请数': '', '本年新增获得数': '', '累计数量申请数': '', '累计数量获得数': ''}
    }

    for pattern, standard_name, category in patterns:
        matches = re.findall(pattern, cleaned_text)
        for match in matches:
            if standard_name in patent_data[category]:
                # 如果字段已经有值，取最新的匹配结果
                patent_data[category][standard_name] = match

    # 将数据整理成最终的列表形式
    result = []
    for category in patent_data:
        result.append(patent_data[category])

    return result

# 示例文本
text = """
至 2023 年末，公司累计获得授权专利 798 件，其中发明专利 50 件，实用新型 748 件；同时，目前正在申请的专利为 326 件，其中发明专利 147 件，实用新型 179 件

深交所
1.p18页   sql未提取
截至 2023 年末，公司研发团队规模为 2,809 人，公司累计核准有效专利 801 项、累计申请中专利 264 项


ETP000002KR4    软通动力信息技术(集团)股份有限公司

 截至报告期末，软通动力共取得2357项计算机软件著作权、227项专利。


供一站式光学解决方案的能力，具备行业竞争优势。截至2023年12月31日，公司拥有国内外有效专利579项，其中发明专利83项，实用新型专利442项，外观设计专利54项。



等科研院所，推进产学研合作。公司分别在环保包装、3D印刷、功能包装材料、生物基材料、智能制造和包装物联网等方向，积极推进科技攻关，逐步锻造核心技术自主研发能力。截至报告期末，公司已取得专利1370项，其中发明专利165项、实用新型专利1129项、外观设计专利76项。公司主导完成国家级、省级和市级科技攻关项目20项，并先后获得毕昇印刷科技进步奖、国际发明展览会“发明创业奖·项目奖”金奖、中国包装联合会科学技术奖以及中国专利优秀奖等10余项荣誉。




    截止报告期末，公司共递交专利申请363件，拥有有效专利139件：其中，发明128件，实用新型11件。报告期内，公司新递交发明专利申请23件，获得发明专利授权5件。
"""

# 提取并分类专利信息
extracted_data = extract_and_classify_patent_info(text)

# 打印结果
# for item in extracted_data:
#     print(item)